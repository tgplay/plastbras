"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[392],{17426:function(e,t,a){var i=a(65443),o=a.n(i),s=a(99581),n=a(70079),r=a(46538),l=a(903),c=a(28070),d=a(47585),m=a(46824),p=a(81433),u=a(10159),_=a(64645),h=a(43232),g=a(18883),x=a(7936),v=a(15312),b=a(59272),j=a(19967),f=a(38721),y=a(8902),N=a(48405),k=a(17416),w=a(60626),S=a(87734),Z=a(96328),C=a(76767),A=a(51448),D=a(35250);function E(e){let{children:t}=e;const{automationName:a,automationStatus:i,showIconLabels:o}=(0,u.Z)((e=>({automationName:e(C.storeName).getAutomationData().name,automationStatus:e(C.storeName).getAutomationData().status,showIconLabels:e(C.storeName).isFeatureActive("showIconLabels")})),[]),s=(0,n.useRef)();let r="mailpoet-automation-editor-chip-gray";return i===A.b.ACTIVE?r="mailpoet-automation-editor-chip-success":i===A.b.DEACTIVATING&&(r="mailpoet-automation-editor-chip-danger"),(0,D.jsx)("div",{className:"edit-site-document-actions has-secondary-label",children:(0,D.jsx)("div",{ref:s,className:"edit-site-document-actions__title-wrapper",children:t&&(0,D.jsx)(k.Z,{popoverProps:{placement:"bottom",anchor:s.current},renderToggle:e=>{let{isOpen:t,onToggle:s}=e;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(l.ZP,{className:"mailpoet-automation-editor-dropdown-toggle-link",onClick:s,children:[(0,D.jsxs)(w.Z,{size:"body",className:"edit-site-document-actions__title",as:"h1",children:[(0,D.jsx)(S.Z,{as:"span",children:(0,x.__)("Editing automation:","mailpoet")}),a]}),(0,D.jsxs)(w.Z,{size:"body",className:`edit-site-document-actions__secondary-item ${r}`,children:[i===A.b.ACTIVE&&(0,x.__)("Active","mailpoet"),i===A.b.DEACTIVATING&&(0,x.__)("Deactivating","mailpoet"),i===A.b.DRAFT&&(0,x.__)("Draft","mailpoet")]})]}),(0,D.jsx)(l.ZP,{className:"edit-site-document-actions__get-info",icon:Z.Z,"aria-expanded":t,"aria-haspopup":"true",onClick:s,label:(0,x.__)("Change automation name","mailpoet"),children:o&&(0,x.__)("Rename","mailpoet")})]})},contentClassName:"edit-site-document-actions__info-dropdown",renderContent:t})})})}E.displayName="DocumentActions";var T=a(80110),P=a(33306),I=a(1583);function F(e){let{size:t="medium",children:a}=e;return(0,D.jsx)("div",{className:o()({"mailpoet-automation-chip":!0,"chip-small":"small"===t,"chip-medium":"medium"===t,"chip-large":"large"===t}),children:a})}function R(e){let{foreground:t,background:a,...i}=e;return(0,D.jsx)("div",{className:"mailpoet-automation-colored-icon",style:{width:i.width,height:i.height,backgroundColor:a,fill:t},children:(0,D.jsx)(c.Z,{...i})})}const L=d.Z,V=(0,n.createContext)(void 0);function H(e){let{stepId:t}=e;const a=(0,n.useContext)(V),{steps:i,automationData:o}=(0,u.Z)((e=>({steps:e(C.storeName).getSteps(),automationData:e(C.storeName).getAutomationData()})),[]),{openSidebar:s,selectStep:r}=(0,N.Z)(C.storeName),l=o.steps[t],c=i.find((e=>{let{key:t}=e;return t===l.key}));return(0,D.jsxs)(T.A,{className:"mailpoet-automation-step-error",role:"listitem",state:a,onClick:()=>{s(C.stepSidebarKey),r(l)},children:[(0,D.jsx)(R,{icon:c.icon,foreground:c.foreground,background:c.background,width:"23px",height:"23px"}),c.title(l,"other")]})}function M(){const[e,t]=(0,n.useState)(!1),a=(0,P.u)({orientation:"vertical",shift:!0}),{errors:i,automationData:o}=(0,u.Z)((e=>({errors:e(C.storeName).getErrors(),automationData:e(C.storeName).getAutomationData()})),[]),s=(0,n.useMemo)((()=>{if(!i)return[];const e=new Map,t=o.steps.root.next_steps.map((e=>{let{id:t}=e;return t}));for(;t.length>0;){const n=t.shift();var a,s;e.has(n)||(e.set(n,i.steps[n]),null===(a=o.steps[n])||void 0===a||null===(s=a.next_steps)||void 0===s||s.forEach((e=>t.push(e.id))))}return[...e.values()].filter((e=>!!e))}),[i,o]),r=s.length>0;return(0,n.useEffect)((()=>{r&&t(!0)}),[r]),0===s.length?null:(0,D.jsxs)("div",{children:[(0,D.jsx)(l.ZP,{variant:"link",onClick:()=>t((e=>void 0!==e&&!e)),onMouseDown:()=>t((e=>e?void 0:e)),style:{textDecoration:"none",borderRadius:99999},children:(0,D.jsxs)(F,{children:[s.length," issues"]})}),e&&(0,D.jsx)(L,{offset:10,placement:"bottom-end",onClose:()=>t((e=>void 0===e&&void 0)),children:(0,D.jsx)(V.Provider,{value:a,children:(0,D.jsxs)(I.b,{state:a,role:"list","aria-label":(0,x.__)("Automation errors","mailpoet"),className:"mailpoet-automation-errors",children:[(0,D.jsx)("div",{className:"mailpoet-automation-errors-header",children:(0,x.__)("The following steps are not fully set:","mailpoet")}),(0,D.jsx)(b.ErrorBoundary,{children:s.map((e=>(0,D.jsx)(H,{stepId:e.step_id},e.step_id)))})]})})})]})}H.displayName="StepError";var O=a(75527),B=a(74731);function K(){const{isInserterOpened:e,showIconLabels:t}=(0,u.Z)((e=>({isInserterOpened:e(C.storeName).isInserterSidebarOpened(),showIconLabels:e(C.storeName).isFeatureActive("showIconLabels")})),[]),{toggleInserterSidebar:a}=(0,N.Z)(C.storeName);return(0,D.jsx)(O.Z,{as:l.ZP,className:"edit-site-header-toolbar__inserter-toggle",variant:"primary",isPressed:e,onMouseDown:e=>e.preventDefault(),onClick:a,icon:B.Z,label:(0,x.__)("Toggle step inserter","mailpoet"),showTooltip:!t,children:t&&(e?(0,x.__)("Close","mailpoet"):(0,x.__)("Add","mailpoet"))})}var U=a(66426),W=a(32828),z=a(50899),G=a(71458),$=a(15439),q=a(6107);function J(e){let{scope:t,name:a,label:i,info:o,messageActivated:s,messageDeactivated:r,shortcut:l,onToggle:c=(()=>null),disabled:d=!1}=e;const m=(0,u.Z)((e=>!!e(q.h).get(t,a)),[a]),{toggle:p}=(0,N.Z)(q.h);return(0,n.createElement)(W.Z,{icon:m&&G.Z,isSelected:m,onClick:()=>{c(),p(t,a),(()=>{if(m){const e=r||(0,x.sprintf)((0,x.__)("Preference deactivated - %s"),i);(0,$.D)(e)}else{const e=s||(0,x.sprintf)((0,x.__)("Preference activated - %s"),i);(0,$.D)(e)}})()},role:"menuitemcheckbox",info:o,shortcut:l,disabled:d},i)}var Y=a(87929);function Q(){return(0,D.jsx)(h.Eo,{className:"edit-site-more-menu",popoverProps:{className:"edit-site-more-menu__content"},children:()=>(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(U.Z,{label:(0,x._x)("View","noun","mailpoet"),children:(0,D.jsx)(J,{scope:C.storeName,name:"fullscreenMode",label:(0,x.__)("Fullscreen mode","mailpoet"),info:(0,x.__)("Work without distraction","mailpoet"),messageActivated:(0,x.__)("Fullscreen mode activated","mailpoet"),messageDeactivated:(0,x.__)("Fullscreen mode deactivated","mailpoet"),shortcut:z.displayShortcut.secondary("f")})}),(0,D.jsx)(U.Z,{children:(0,D.jsx)(W.Z,{onClick:()=>{window.location.href=Y.x.urls.automationListing},children:(0,x.__)("View all automations","mailpoet")})})]})})}var X=a(44165);function ee(e){let{onClose:t}=e;const[a,i]=(0,n.useState)(!1);return(0,D.jsxs)(X.Z,{className:"mailpoet-automatoin-deactivate-modal",title:(0,x.__)("Stop automation for all subscribers?","mailpoet"),onRequestClose:t,children:[(0,D.jsx)("p",{children:(0,x.__)("Are you sure you want to deactivate now? This would stop this automation for all subscribers immediately.","mailpoet")}),(0,D.jsx)(l.ZP,{isBusy:a,variant:"primary",onClick:()=>{i(!0),(0,p.dispatch)(C.storeName).deactivate(!0)},children:(0,x.__)("Deactivate now","mailpoet")}),(0,D.jsx)(l.ZP,{disabled:a,variant:"tertiary",onClick:t,children:(0,x.__)("Cancel","mailpoet")})]})}function te(e){let{onClose:t}=e;const{automationName:a}=(0,u.Z)((e=>({automationName:e(C.storeName).getAutomationData().name})),[]),[i,o]=(0,n.useState)(A.b.DEACTIVATING),[s,r]=(0,n.useState)(!1),c=(0,x.sprintf)((0,x.__)('Deactivate the "%s" automation?',"mailpoet"),a);return(0,D.jsxs)(X.Z,{className:"mailpoet-automatoin-deactivate-modal",title:c,onRequestClose:t,children:[(0,x.__)("Some subscribers entered but have not finished the flow. Let's decide what to do in this case.","mailpoet"),(0,D.jsxs)("ul",{className:"mailpoet-automation-options",children:[(0,D.jsx)("li",{children:(0,D.jsxs)("label",{className:i===A.b.DEACTIVATING?"mailpoet-automation-option active":"mailpoet-automation-option",children:[(0,D.jsx)("span",{children:(0,D.jsx)("input",{type:"radio",disabled:s,name:"deactivation-method",checked:i===A.b.DEACTIVATING,onChange:()=>o(A.b.DEACTIVATING)})}),(0,D.jsxs)("span",{children:[(0,D.jsx)("strong",{children:(0,x.__)("Let entered subscribers finish the flow","mailpoet")}),(0,x.__)("New subscribers won't enter, but recently entered could proceed.","mailpoet")]})]})}),(0,D.jsx)("li",{children:(0,D.jsxs)("label",{className:i===A.b.DRAFT?"mailpoet-automation-option active":"mailpoet-automation-option",children:[(0,D.jsx)("span",{children:(0,D.jsx)("input",{type:"radio",disabled:s,name:"deactivation-method",checked:i===A.b.DRAFT,onChange:()=>o(A.b.DRAFT)})}),(0,D.jsxs)("span",{children:[(0,D.jsx)("strong",{children:(0,x.__)("Stop automation for all subscribers","mailpoet")}),(0,x.__)("Automation will be deactivated for all the subscribers immediately.","mailpoet")]})]})})]}),(0,D.jsx)(l.ZP,{isBusy:s,variant:"primary",onClick:()=>{r(!0),(0,p.dispatch)(C.storeName).deactivate(i!==A.b.DEACTIVATING)},children:(0,x.__)("Deactivate automation","mailpoet")}),(0,D.jsx)(l.ZP,{disabled:s,variant:"tertiary",onClick:t,children:(0,x.__)("Cancel","mailpoet")})]})}function ae(e){let{label:t}=e;const{errors:a,isDeactivating:i}=(0,u.Z)((e=>({errors:e(C.storeName).getErrors(),isDeactivating:e(C.storeName).getAutomationData().status===A.b.DEACTIVATING})),[]),{openActivationPanel:o}=(0,N.Z)(C.storeName),s=(0,D.jsx)(l.ZP,{variant:"primary",className:"editor-post-publish-button",onClick:o,disabled:i||!!a,children:t});return i?(0,D.jsx)(j.Z,{delay:0,text:(0,x.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),children:s}):s}function ie(){const{save:e}=(0,N.Z)(C.storeName),{automation:t}=(0,u.Z)((e=>({automation:e(C.storeName).getAutomationData()})),[]);return 0===t.stats.totals.in_progress?(0,D.jsx)(l.ZP,{variant:"primary",className:"editor-post-publish-button",onClick:e,children:(0,x.__)("Update","mailpoet")}):(0,D.jsx)(j.Z,{delay:0,text:(0,x.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),children:(0,D.jsx)(l.ZP,{variant:"primary",className:"editor-post-publish-button",onClick:e,disabled:!0,children:(0,x.__)("Update","mailpoet")})})}function oe(){const{save:e}=(0,N.Z)(C.storeName);return(0,D.jsx)(l.ZP,{variant:"tertiary",onClick:e,children:(0,x.__)("Save draft","mailpoet")})}function se(){const[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(!1),{hasUsersInProgress:o}=(0,u.Z)((e=>({hasUsersInProgress:e(C.storeName).getAutomationData().stats.totals.in_progress>0})),[]);return(0,D.jsxs)(D.Fragment,{children:[e&&(0,D.jsx)(te,{onClose:()=>{t(!1)}}),(0,D.jsx)(l.ZP,{isBusy:a,variant:"tertiary",onClick:()=>{o?t(!0):(i(!0),(0,p.dispatch)(C.storeName).deactivate())},children:(0,x.__)("Deactivate","mailpoet")})]})}function ne(){const[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(!1),{hasUsersInProgress:o}=(0,u.Z)((e=>({hasUsersInProgress:e(C.storeName).getAutomationData().stats.totals.in_progress>0})),[]);return(0,D.jsxs)(D.Fragment,{children:[e&&(0,D.jsx)(ee,{onClose:()=>{t(!1)}}),(0,D.jsx)(l.ZP,{isBusy:a,variant:"tertiary",onClick:()=>{o?t(!0):(i(!0),(0,p.dispatch)(C.storeName).deactivate())},children:(0,x.__)("Deactivate now","mailpoet")})]})}function re(e){let{showInserterToggle:t}=e;const{setAutomationName:a}=(0,N.Z)(C.storeName),{automationName:i,automationStatus:o}=(0,u.Z)((e=>({automationName:e(C.storeName).getAutomationData().name,automationStatus:e(C.storeName).getAutomationData().status})),[]);return(0,D.jsxs)("div",{className:"edit-site-header-edit-mode",children:[(0,D.jsx)("div",{className:"edit-site-header-edit-mode_start",children:(0,D.jsx)(f.Z,{className:"edit-site-header-edit-mode__toolbar",orientation:"horizontal",role:"toolbar",children:t&&(0,D.jsx)(K,{})})}),(0,D.jsx)("div",{className:"edit-site-header-edit-mode_center",children:(0,D.jsx)(b.ErrorBoundary,{children:(0,D.jsx)(E,{children:()=>(0,D.jsxs)("div",{className:"mailpoet-automation-editor-dropdown-name-edit",children:[(0,D.jsx)("div",{className:"mailpoet-automation-editor-dropdown-name-edit-title",children:(0,x.__)("Automation name","mailpoet")}),(0,D.jsx)(y.Z,{value:i,onChange:e=>a(e),help:(0,x.__)('Give the automation a name that indicates its purpose. E.g. "Abandoned cart recovery"',"mailpoet")})]})})})}),(0,D.jsx)("div",{className:"edit-site-header-edit-mode_end",children:(0,D.jsxs)("div",{className:"edit-site-header-edit-mode__actions",children:[(0,D.jsx)(b.ErrorBoundary,{children:(0,D.jsx)(M,{})}),o===A.b.DRAFT&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(oe,{}),(0,D.jsx)(ae,{label:(0,x.__)("Activate","mailpoet")})]}),o===A.b.ACTIVE&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(se,{}),(0,D.jsx)(ie,{})]}),o===A.b.DEACTIVATING&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(ne,{}),(0,D.jsx)(ae,{label:(0,x.__)("Update & Activate","mailpoet")})]}),(0,D.jsx)(h.Ox.Slot,{scope:C.storeName}),(0,D.jsx)(Q,{})]})})]})}var le=a(17647),ce=a(85180),de=a(50418);function me(e){let{icon:t}=e;return(0,D.jsx)("span",{className:"block-editor-block-icon",children:(0,D.jsx)(c.Z,{icon:t})})}function pe(e){let{item:t}=e;const{title:a,icon:i,description:o}=t;return(0,D.jsx)("div",{className:"block-editor-inserter__preview-container",children:(0,D.jsxs)("div",{className:"block-editor-block-card",children:[(0,D.jsx)(me,{icon:i}),(0,D.jsxs)("div",{className:"block-editor-block-card__content",children:[(0,D.jsx)("h2",{className:"block-editor-block-card__title",children:a(null,"inserter")}),(0,D.jsx)("span",{className:"block-editor-block-card__description",children:o(null,"inserter")})]})]})})}const ue=(0,n.createContext)(void 0),_e=(0,n.forwardRef)(((e,t)=>{let{isFirst:a,children:i,...o}=e;const s=(0,n.useContext)(ue);return(0,D.jsx)(T.A,{ref:t,state:s,role:"option",focusable:!0,...o,children:e=>{const t={...e,tabIndex:a?0:e.tabIndex};return(0,D.jsx)(l.ZP,{...t,children:i})}})})),he=()=>{const{platform:e}=window.navigator;return-1!==e.indexOf("Mac")||["iPad","iPhone"].includes(e)},ge=(0,n.memo)((e=>{let{className:t,isFirst:a,item:i,onSelect:s,onHover:r,isDraggable:l,...c}=e;const d=(0,n.useRef)(!1);return(0,D.jsx)("div",{className:"block-editor-block-types-list__list-item",children:(0,D.jsxs)(_e,{isFirst:a,className:o()("block-editor-block-types-list__item",t),disabled:i.isDisabled,onClick:e=>{e.preventDefault(),s(i,he()?e.metaKey:e.ctrlKey),r(null)},onKeyDown:e=>{const{keyCode:t}=e;t===z.ENTER&&(e.preventDefault(),s(i,he()?e.metaKey:e.ctrlKey),r(null))},onFocus:()=>{d.current||r(i)},onMouseEnter:()=>{d.current||r(i)},onMouseLeave:()=>r(null),onBlur:()=>r(null),...c,children:[(0,D.jsx)("span",{className:"block-editor-block-types-list__item-icon",children:(0,D.jsx)(me,{icon:i.icon})}),(0,D.jsx)("span",{className:"block-editor-block-types-list__item-title",children:i.title(null,"inserter")})]})})})),xe=(0,n.forwardRef)(((e,t)=>{const[a,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{a&&(0,$.D)((0,x.__)("Use left and right arrow keys to move through steps","mailpoet"))}),[a]),(0,D.jsx)("div",{ref:t,role:"listbox","aria-orientation":"horizontal",onFocus:()=>{i(!0)},onBlur:e=>{!e.currentTarget.contains(e.relatedTarget)&&i(!1)},...e})}));var ve=a(11215);const be=(0,n.forwardRef)(((e,t)=>{const a=(0,n.useContext)(ue);return(0,D.jsx)(ve.E,{state:a,role:"presentation",ref:t,...e})})),je=(e,t)=>{const a=[];for(let i=0,o=e.length;i<o;i+=t)a.push(e.slice(i,i+t));return a};function fe(e){let{items:t,onSelect:a,onHover:i,label:o,isDraggable:s=!0,children:n}=e;return(0,D.jsxs)(xe,{className:"block-editor-block-types-list","aria-label":o,children:[je(t,3).map(((e,t)=>(0,D.jsx)(be,{children:e.map(((e,o)=>{return(0,D.jsx)(ge,{item:e,className:(n=e.key,`editor-block-list-item-${n.replace(/\//,"-")}`),onSelect:a,onHover:i,isDraggable:s,isFirst:0===t&&0===o},e.key);var n}))},t))),n]})}function ye(e){let{children:t}=e;const a=(0,P.u)({shift:!0,wrap:"horizontal"});return(0,D.jsx)(ue.Provider,{value:a,children:t})}const Ne=(0,n.forwardRef)(((e,t)=>{let{onInsert:a,showInserterHelpPanel:i=!0}=e;const[o,s]=(0,n.useState)(""),[r,l]=(0,n.useState)(null),{steps:c,type:d}=(0,u.Z)((e=>({steps:e(C.storeName).getSteps(),type:e(C.storeName).getInserterPopover().type})),[]),m=(0,n.useMemo)((()=>"triggers"===d?[{type:"triggers",title:void 0,label:(0,x._x)("Triggers","automation steps","mailpoet"),items:c.filter((e=>{let{group:t}=e;return"triggers"===t}))}]:[{type:"actions",title:(0,x._x)("Actions","automation steps","mailpoet"),label:(0,x._x)("Actions","automation steps","mailpoet"),items:c.filter((e=>{let{group:t}=e;return"actions"===t}))},{type:"logical",title:(0,x._x)("Logical","automation steps","mailpoet"),label:(0,x._x)("Logical","automation steps","mailpoet"),items:c.filter((e=>{let{group:t}=e;return"logical"===t}))}]),[c,d]),p=(0,n.useCallback)((e=>{l(e)}),[l]),_=(0,n.useRef)();(0,n.useImperativeHandle)(t,(()=>({focusSearch:()=>{var e;null===(e=_.current)||void 0===e||e.focus()}})));const h=(0,n.useMemo)((()=>m.map((e=>{return{...e,items:(t=o,a=e.items,a.filter((e=>e.keywords.map((e=>e.toLowerCase())).join(" ").includes(t.trim().toLowerCase()))))};var t,a}))),[o,m]);return(0,D.jsxs)("div",{className:"block-editor-inserter__menu",children:[(0,D.jsx)("div",{className:"block-editor-inserter__main-area",children:(0,D.jsxs)("div",{className:"block-editor-inserter__content",children:[(0,D.jsx)(le.Z,{className:"block-editor-inserter__search",onChange:e=>{r&&l(null),s(e)},value:o,label:(0,x.__)("Search for automation steps","mailpoet"),placeholder:(0,x.__)("Search","mailpoet"),ref:_}),(0,D.jsx)("div",{className:"block-editor-inserter__block-list",children:(0,D.jsxs)(ye,{children:[h.map((e=>e.items.length>0&&(0,D.jsxs)(n.Fragment,{children:[e.title&&(0,D.jsx)("div",{className:"block-editor-inserter__panel-header",children:(0,D.jsx)("h2",{className:"block-editor-inserter__panel-title",children:(0,D.jsx)("div",{children:e.title})})}),(0,D.jsx)("div",{className:"block-editor-inserter__panel-content",children:(0,D.jsx)(fe,{items:e.items,onHover:p,onSelect:e=>a(e),label:e.label})})]},e.type))),0===h.reduce(((e,t)=>{let{items:a}=t;return e+a.length}),0)&&(0,D.jsxs)("div",{className:"block-editor-inserter__no-results",children:[(0,D.jsx)(ce.Z,{className:"block-editor-inserter__no-results-icon",icon:de.Z}),(0,D.jsx)("p",{children:(0,x.__)("No results found.","mailpoet")})]})]})})]})}),i&&r&&(0,D.jsx)(pe,{item:r})]})}));function ke(){const{isSidebarOpened:e,selectedStep:t}=(0,u.Z)((e=>({isSidebarOpened:e(C.storeName).isSidebarOpened,selectedStep:e(C.storeName).getSelectedStep}))),{openSidebar:a,closeSidebar:i,toggleFeature:o}=(0,N.Z)(C.storeName),{registerShortcut:s}=(0,N.Z)(g.h);return(0,n.useEffect)((()=>{s({name:"mailpoet/automation-editor/toggle-fullscreen",category:"global",description:(0,x.__)("Toggle fullscreen mode.","mailpoet"),keyCombination:{modifier:"secondary",character:"f"}}),s({name:"mailpoet/automation-editor/toggle-sidebar",category:"global",description:(0,x.__)("Show or hide the settings sidebar.","mailpoet"),keyCombination:{modifier:"primaryShift",character:","}})}),[s]),(0,g.bx)("mailpoet/automation-editor/toggle-fullscreen",(()=>{o("fullscreenMode")})),(0,g.bx)("mailpoet/automation-editor/toggle-sidebar",(o=>{if(o.preventDefault(),e())i();else{const e=t()?C.stepSidebarKey:C.automationSidebarKey;a(e)}})),null}var we=a(76761),Se=a(48041),Ze=a(2734),Ce=a(70491);const Ae=(0,n.forwardRef)((function(e,t){let{className:a,children:i,spokenMessage:s=i,politeness:r="polite",actions:c=[],onRemove:d,icon:m=null,explicitDismiss:p=!1,onDismiss:u,listRef:_}=e;function h(e){var t;e&&e.preventDefault&&e.preventDefault(),null==_||null===(t=_.current)||void 0===t||t.focus(),null==u||u(),null==d||d()}!function(e,t){const a="string"==typeof e?e:(0,Ce.ZP)(e);(0,n.useEffect)((()=>{a&&(0,$.D)(a,t)}),[a,t])}(s,r),(0,n.useEffect)((()=>{const e=setTimeout((()=>{p||(null==u||u(),null==d||d())}),1e4);return()=>clearTimeout(e)}),[u,d,p]);const g=o()(a,"components-snackbar",{"components-snackbar-explicit-dismiss":!!p});c&&c.length>1&&("undefined"!=typeof process&&process.env,c=[c[0]]);const v=o()("components-snackbar__content",{"components-snackbar__content-with-icon":!!m});return(0,n.createElement)("div",{ref:t,className:g,onClick:p?void 0:h,tabIndex:0,role:p?"":"button",onKeyPress:p?void 0:h,"aria-label":p?"":(0,x.__)("Dismiss this notice")},(0,n.createElement)("div",{className:v},m&&(0,n.createElement)("div",{className:"components-snackbar__icon"},m),i,c.map(((e,t)=>{let{label:a,onClick:i,url:o}=e;return(0,n.createElement)(l.ZP,{key:t,href:o,variant:"tertiary",onClick:e=>function(e,t){e.stopPropagation(),null==d||d(),t&&t(e)}(e,i),className:"components-snackbar__action"},a)})),p&&(0,n.createElement)("span",{role:"button","aria-label":"Dismiss this notice",tabIndex:0,className:"components-snackbar__dismiss-button",onClick:h,onKeyPress:h},"✕")))}));var De=Ae,Ee=a(79636),Te=a(61755);const Pe={init:{height:0,opacity:0},open:{height:"auto",opacity:1,transition:{height:{stiffness:1e3,velocity:-100}}},exit:{opacity:0,transition:{duration:.5}}};var Ie=function(e){let{notices:t,className:a,children:i,onRemove:s}=e;const r=(0,n.useRef)(null),l=(0,Ze.Z)();a=o()("components-snackbar-list",a);const c=e=>()=>null==s?void 0:s(e.id);return(0,n.createElement)("div",{className:a,tabIndex:-1,ref:r},i,(0,n.createElement)(Ee.M,null,t.map((e=>{const{content:t,...a}=e;return(0,n.createElement)(Te.E.div,{layout:!l,initial:"init",animate:"open",exit:"exit",key:e.id,variants:l?void 0:Pe},(0,n.createElement)("div",{className:"components-snackbar-list__notice-container"},(0,n.createElement)(De,(0,Se.Z)({},a,{onRemove:c(e),listRef:r}),e.content)))}))))};function Fe(){const{notices:e}=(0,u.Z)((e=>({notices:e(m.h).getNotices()})),[]),{removeNotice:t}=(0,N.Z)(m.h),a=e.filter((e=>{let{isDismissible:t,type:a}=e;return t&&"default"===a})),i=e.filter((e=>{let{isDismissible:t,type:a}=e;return!t&&"default"===a})),o=e.filter((e=>{let{type:t}=e;return"snackbar"===t}));return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(we.Z,{notices:i,className:"mailpoet-automation-editor-notices__notice-list"}),(0,D.jsx)(we.Z,{notices:a,className:"mailpoet-automation-editor-notices__notice-list",onRemove:t}),(0,D.jsx)(Ie,{notices:o,className:"mailpoet-automation-editor-notices__snackbar-list",onRemove:t})]})}var Re=a(37392),Le=a(45029);function Ve(e){let{sidebarKey:t}=e;const{openSidebar:a}=(0,N.Z)(C.storeName),[i,o]=t===C.automationSidebarKey?[(0,x.__)("Automation (selected)","mailpoet"),"is-active"]:[(0,x.__)("Automation","mailpoet"),""],[s,n]=t===C.stepSidebarKey?[(0,x.__)("Step (selected)","mailpoet"),"is-active"]:[(0,x.__)("Step","mailpoet"),""];return(0,D.jsxs)("ul",{children:[(0,D.jsx)("li",{children:(0,D.jsx)(l.ZP,{onClick:()=>a(C.automationSidebarKey),className:`edit-site-sidebar-edit-mode__panel-tab ${o}`,"aria-label":i,"data-label":(0,x.__)("Automation","mailpoet"),children:(0,x.__)("Automation","mailpoet")})}),(0,D.jsx)("li",{children:(0,D.jsx)(l.ZP,{onClick:()=>a(C.stepSidebarKey),className:`edit-site-sidebar-edit-mode__panel-tab ${n}`,"aria-label":s,"data-label":(0,x.__)("Step","mailpoet"),children:(0,x.__)("Step","mailpoet")})})]})}var He=a(67172),Me=a(29813);function Oe(e){let{title:t,description:a,icon:i}=e;return(0,D.jsxs)("div",{className:"block-editor-block-card",children:[(0,D.jsx)(me,{icon:i}),(0,D.jsxs)("div",{className:"block-editor-block-card__content",children:[(0,D.jsx)("h2",{className:"block-editor-block-card__title",children:t}),(0,D.jsx)("span",{className:"block-editor-block-card__description",children:a})]})]})}function Be(){var e;const{errors:t}=(0,u.Z)((e=>({errors:e(C.storeName).getStepError(e(C.storeName).getSelectedStep().id)})),[]);if(!t||null==t||!t.fields)return null;const a=null===(e=t.fields)||void 0===e?void 0:e.general;return a?(0,D.jsx)(He.Z,{isDismissible:!1,status:"error",children:a}):null}function Ke(){const{selectedStep:e,selectedStepType:t}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep(),selectedStepType:e(C.storeName).getSelectedStepType()})),[]);if(!e)return(0,D.jsx)(Me.Z,{children:"No step selected."});if(!t)return(0,D.jsx)(Me.Z,{children:"Unknown step type."});const a=t.edit;return(0,D.jsxs)("div",{className:"block-editor-block-inspector",children:[(0,D.jsx)(Be,{}),(0,D.jsx)(Oe,{title:t.title(e,"sidebar"),description:t.description(e,"sidebar"),icon:t.icon}),(0,D.jsx)(a,{},e.id)]})}var Ue=a(70660),We=a(6147);function ze(){const[e,t]=(0,n.useState)(!1),{automation:a}=(0,u.Z)((e=>({automation:e(C.storeName).getAutomationData()})),[]),{trash:i}=(0,N.Z)(C.storeName);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(We.Z,{isOpen:e,title:(0,x.__)("Delete automation","mailpoet"),confirmButtonText:(0,x.__)("Yes, delete","mailpoet"),onConfirm:async()=>{i((()=>{t(!1)}))},onCancel:()=>t(!1),__experimentalHideHeader:!1,children:[(0,x.sprintf)((0,x.__)('You are about to delete the automation "%s".',"mailpoet"),a.name),(0,D.jsx)("br",{}),(0,x.__)(" This will stop it for all subscribers immediately.","mailpoet")]}),(0,D.jsx)(l.ZP,{variant:"secondary",isDestructive:!0,onClick:()=>t(!0),children:(0,x.__)("Move to Trash","mailpoet")})]})}var Ge=a(77977),$e=a(34517);function qe(){const e=$e.Hooks.applyFilters("mailpoet.automation.settings.render",{});return 0===Object.keys(e).length?null:(0,D.jsx)(Me.Z,{title:(0,x.__)("Automation settings","mailpoet"),initialOpen:!0,children:Object.keys(e).map((t=>(0,D.jsx)(Ue.Z,{children:e[t]},t)))})}function Je(){const{automationData:e}=(0,u.Z)((e=>({automationData:e(C.storeName).getAutomationData()})),[]),t={year:"numeric",month:"long",day:"numeric"};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(Me.Z,{title:(0,x.__)("Automation details","mailpoet"),initialOpen:!0,children:[(0,D.jsxs)(Ue.Z,{children:[(0,D.jsx)("strong",{children:"Date added"})," ",new Date(Date.parse(e.created_at)).toLocaleDateString(Ge.locale.toString(),t)]}),(0,D.jsxs)(Ue.Z,{children:[(0,D.jsx)("strong",{children:"Activated"})," ","active"===e.status&&new Date(Date.parse(e.updated_at)).toLocaleDateString(Ge.locale.toString(),t),"active"!==e.status&&e.activated_at&&new Date(Date.parse(e.activated_at)).toLocaleDateString(Ge.locale.toString(),t),"active"!==e.status&&!e.activated_at&&(0,D.jsx)("span",{className:"mailpoet-deactive",children:"Not activated yet."})]}),(0,D.jsxs)(Ue.Z,{children:[(0,D.jsx)("strong",{children:"Author"})," ",e.author.name]}),(0,D.jsx)(Ue.Z,{children:(0,D.jsx)(ze,{})})]}),(0,D.jsx)(qe,{})]})}const Ye=Re.Z.select({web:!0,native:!1});function Qe(e){const{keyboardShortcut:t,sidebarKey:a,showIconLabels:i,automationName:o}=(0,u.Z)((e=>({keyboardShortcut:e(g.h).getShortcutRepresentation("mailpoet/automation-editor/toggle-sidebar"),sidebarKey:e(h.h).getActiveComplementaryArea(C.storeName)??C.automationSidebarKey,showIconLabels:e(C.storeName).isFeatureActive("showIconLabels"),automationName:e(C.storeName).getAutomationData().name})),[]);return(0,D.jsxs)(h.Vi,{identifier:a,header:(0,D.jsx)(Ve,{sidebarKey:a}),closeLabel:(0,x.__)("Close settings","mailpoet"),headerClassName:"edit-site-sidebar-edit-mode__panel-tabs",title:(0,x.__)("Settings","mailpoet"),icon:Le.Z,className:"edit-site-sidebar mailpoet-automation-sidebar",panelClassName:"edit-site-sidebar",smallScreenTitle:o||(0,x.__)("(no title)","mailpoet"),scope:C.storeName,toggleShortcut:t,isActiveByDefault:Ye,showIconLabels:i,...e,children:[a===C.automationSidebarKey&&(0,D.jsx)(Je,{}),a===C.stepSidebarKey&&(0,D.jsx)(Ke,{})]})}const Xe=(0,n.createContext)(void 0);function et(){return(0,D.jsx)("div",{className:"mailpoet-automation-editor-empty-automation",children:(0,x.__)("No automation data.","mailpoet")})}function tt(e){let{onClick:t,previousStepId:a}=e;const i=(0,n.useContext)(Xe);return(0,D.jsx)(T.A,{state:i,role:"treeitem",className:"mailpoet-automation-editor-add-step-button",focusable:!0,"data-previous-step-id":a,onClick:e=>{e.stopPropagation();const a=e.target.closest("button");t(a)},children:(0,D.jsx)(ce.Z,{icon:B.Z,size:16})})}function at(e){let{previousStepId:t}=e;const{setInserterPopover:a}=(0,p.dispatch)(C.storeName);return(0,D.jsx)("div",{className:"mailpoet-automation-editor-separator",children:(0,D.jsx)(tt,{onClick:e=>a({anchor:e,type:"steps"}),previousStepId:t})})}var it=a(10962),ot=a(6263),st=a(86849),nt=a(59568),rt=a(74457),lt=a(33357);function ct(e){let{step:t}=e;const[a,i]=(0,n.useState)(!1),o=$e.Hooks.applyFilters("mailpoet.automation.step.more-controls",{delete:{key:"delete",control:{title:(0,x.__)("Delete step","mailpoet"),icon:nt.Z,onClick:()=>i(!0)},slot:()=>!!a&&(0,D.jsx)(lt.ZG,{onRequestClose:()=>{i(!1)},tracking:{utm_medium:"upsell_modal",utm_campaign:"remove_automation_step"},children:(0,x.__)("You cannot remove a step from the automation.","mailpoet")})}},t),s=Object.values(o).filter((e=>void 0!==e.slot)),r=Object.values(o).map((e=>e.control));return(0,D.jsxs)("div",{className:"mailpoet-automation-step-more-menu",children:[s.map((e=>{let{key:t,slot:a}=e;return(0,D.jsx)(a,{},t)})),(0,D.jsx)(st.Z,{label:(0,x.__)("More","mailpoet"),icon:rt.Z,popoverProps:{position:"bottom right"},toggleProps:{isSmall:!0},controls:Object.values(r)})]})}function dt(e){let{step:t,isSelected:a}=e;const{stepType:i,error:s}=(0,u.Z)((e=>({stepType:e(C.storeName).getStepType(t.key),error:e(C.storeName).getStepError(t.id)})),[t]),{openSidebar:r,selectStep:l}=(0,N.Z)(C.storeName),c=(0,n.useContext)(Xe),{batch:d}=(0,it.Z)(),m=`step-${t.id}`,p=i??(e=>{const t="trigger"===e.type;return{title:()=>t?(0,x.__)("Unknown trigger","mailpoet"):(0,x.__)("Unknown step","mailpoet"),subtitle:()=>t?(0,x.__)("Trigger type not registered","mailpoet"):(0,x.__)("Step type not registered","mailpoet"),description:()=>t?(0,x.__)("Unknown trigger","mailpoet"):(0,x.__)("Unknown step","mailpoet"),keywords:[],group:"trigger"===e.type?"triggers":"actions",key:e.key,foreground:"#8c8f94",background:"#dcdcde",edit:()=>null,icon:()=>ot.Z}})(t);return(0,D.jsxs)("div",{className:"mailpoet-automation-editor-step-wrapper",children:[(0,D.jsx)(ct,{step:t}),(0,D.jsxs)(T.A,{state:c,role:"treeitem",className:o()({"mailpoet-automation-editor-step":!0,"is-selected-step":a,"is-unknown-step":!i}),id:m,focusable:!0,onClick:()=>d((()=>{r(C.stepSidebarKey),l(t)})),children:[(0,D.jsx)("div",{className:"mailpoet-automation-editor-step-icon",children:(0,D.jsx)(R,{icon:p.icon,foreground:p.foreground,background:p.background,width:"23px",height:"23px"})}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:m,className:"mailpoet-automation-editor-step-title",children:"trigger"!==t.type?p.title(t,"automation"):(0,x._x)("Trigger","noun","mailpoet")}),(0,D.jsx)("div",{className:"mailpoet-automation-editor-step-subtitle",children:"trigger"!==t.type?p.subtitle(t,"automation"):p.title(t,"automation")})]}),s&&(0,D.jsx)("div",{className:"mailpoet-automation-editor-step-footer",children:(0,D.jsx)("div",{className:"mailpoet-automation-editor-step-error",children:(0,D.jsx)(F,{size:"small",children:(0,x.__)("Not set","mailpoet")})})})]},t.id)]})}function mt(){const e=(0,n.useRef)(),[t,a]=(0,n.useState)(!1),{inserterPopover:i}=(0,u.Z)((e=>({inserterPopover:e(C.storeName).getInserterPopover()})),[]),{setInserterPopover:o}=(0,N.Z)(C.storeName),s=(0,n.useCallback)((e=>{$e.Hooks.applyFilters("mailpoet.automation.add_step_callback",(()=>{a(!0)}))(e)}),[]);return i?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(d.Z,{ref:e,anchorRect:i.anchor.getBoundingClientRect(),onClose:()=>{t||o(void 0)},children:(0,D.jsx)(Ne,{onInsert:s,showInserterHelpPanel:!1})}),t&&(0,D.jsx)(lt.ZG,{onRequestClose:()=>{var t;a(!1),null===(t=e.current)||void 0===t||t.focus()},tracking:{utm_medium:"upsell_modal",utm_campaign:"add_automation_step"},children:(0,x.__)("You cannot add a new step to the automation.","mailpoet")})]}):null}function pt(e){let{step:t}=e;const a=(0,n.useContext)(Xe),{setInserterPopover:i}=(0,N.Z)(C.storeName);return(0,D.jsxs)(T.A,{state:a,role:"treeitem",className:"mailpoet-automation-add-trigger","data-previous-step-id":t.id,focusable:!0,onClick:e=>{e.stopPropagation(),i({anchor:e.target.closest("button"),type:"triggers"})},children:[(0,D.jsx)(ce.Z,{icon:B.Z,size:16}),(0,x.__)("Add trigger","mailpoet")]})}var ut=a(24775);function _t(){const{automation:e}=(0,u.Z)((e=>({automation:e(C.storeName).getAutomationData()})),[]);return(0,D.jsx)("div",{className:"mailpoet-automation-editor-stats",children:(0,D.jsx)(ut.g,{items:[{key:"entered",label:(0,x._x)("Total Entered","automation stats","mailpoet"),value:e.stats.totals.entered},{key:"processing",label:(0,x._x)("Total Processing","automation stats","mailpoet"),value:e.stats.totals.in_progress},{key:"exited",label:(0,x._x)("Total Exited","automation stats","mailpoet"),value:e.stats.totals.exited}]})})}function ht(){const{automationData:e,selectedStep:t}=(0,u.Z)((e=>({automationData:e(C.storeName).getAutomationData(),selectedStep:e(C.storeName).getSelectedStep()})),[]),a=(0,P.u)({orientation:"vertical",wrap:"horizontal",shift:!0}),i=(null==e?void 0:e.steps)??void 0,o=(0,n.useMemo)((()=>{const e=[i.root];for(;;){const t=e[e.length-1];if(!t||0===t.next_steps.length)break;e.push(i[t.next_steps[0].id])}return e.slice(1)}),[i]),s=(0,n.useMemo)((()=>$e.Hooks.applyFilters("mailpoet.automation.render_step",(e=>"root"===e.type?(0,D.jsx)(pt,{step:e}):(0,D.jsx)(dt,{step:e,isSelected:t&&e.id===t.id})))),[t]),r=(0,n.useMemo)((()=>$e.Hooks.applyFilters("mailpoet.automation.render_step_separator",(e=>(0,D.jsx)(at,{previousStepId:e.id})))),[]);return e?(0,D.jsx)(Xe.Provider,{value:a,children:(0,D.jsxs)(I.b,{state:a,role:"tree","aria-label":(0,x.__)("Automation","mailpoet"),"aria-orientation":"vertical",className:"mailpoet-automation-editor-automation",children:[(0,D.jsxs)("div",{className:"mailpoet-automation-editor-automation-wrapper",children:[(0,D.jsx)(_t,{}),0===i.root.next_steps.length?(0,D.jsxs)(D.Fragment,{children:[s(i.root),r(i.root)]}):i.root.next_steps.map((e=>{var t;let{id:a}=e;return"trigger"!==(null===(t=i[a])||void 0===t?void 0:t.type)&&(0,D.jsxs)(n.Fragment,{children:[s(i.root),r(i.root)]},`root-${a}`)})),o.map((e=>(0,D.jsxs)(n.Fragment,{children:[s(e),r(e)]},e.id))),(0,D.jsx)(ce.Z,{className:"mailpoet-automation-editor-automation-end",icon:G.Z}),(0,D.jsx)("div",{})]}),(0,D.jsx)(mt,{})]})}):(0,D.jsx)(et,{})}var gt=a(15160),xt=a(4723),vt=a(34109),bt=a(38241),jt=a(1314);const ft=[{label:(0,x.__)("Minutes","mailpoet"),subtitle:e=>(0,x.sprintf)((0,x._n)("Wait for %d minute","Wait for %d minutes",e,"mailpoet"),e),value:"MINUTES"},{label:(0,x.__)("Hours","mailpoet"),subtitle:e=>(0,x.sprintf)((0,x._n)("Wait for %d hour","Wait for %d hours",e,"mailpoet"),e),value:"HOURS"},{label:(0,x.__)("Days","mailpoet"),subtitle:e=>(0,x.sprintf)((0,x._n)("Wait for %d day","Wait for %d days",e,"mailpoet"),e),value:"DAYS"},{label:(0,x.__)("Weeks","mailpoet"),subtitle:e=>(0,x.sprintf)((0,x._n)("Wait for %d week","Wait for %d weeks",e,"mailpoet"),e),value:"WEEKS"}],yt={key:"core:delay",group:"actions",title:()=>(0,x._x)("Delay","noun","mailpoet"),description:()=>(0,x.__)("Wait some time before proceeding with the steps below.","mailpoet"),subtitle:e=>{return e.args.delay&&e.args.delay_type?(t=e.args.delay_type,a=e.args.delay,ft.reduce(((e,i)=>i.value!==t?e:i.subtitle(a)),"")):(0,x.__)("Not set up yet","mailpoet");var t,a},keywords:[(0,x.__)("wait","mailpoet"),(0,x.__)("pause","mailpoet"),(0,x.__)("delay","mailpoet"),(0,x.__)("time","mailpoet")],foreground:"#7F54B3",background:"#f7edf7",icon:function(){return(0,D.jsx)("svg",{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,D.jsx)("path",{d:"M9.79683 0.666656C4.6635 0.666656 0.463501 4.86666 0.463501 9.99999C0.463501 15.1333 4.6635 19.3333 9.79683 19.3333C14.9302 19.3333 19.1302 15.1333 19.1302 9.99999C19.1302 4.86666 14.9302 0.666656 9.79683 0.666656ZM9.79683 17.4667C5.68083 17.4667 2.33017 14.116 2.33017 9.99999C2.33017 5.88399 5.68083 2.53332 9.79683 2.53332C13.9128 2.53332 17.2635 5.88399 17.2635 9.99999C17.2635 14.116 13.9128 17.4667 9.79683 17.4667ZM10.2635 5.33332H8.8635V10.9333L13.7168 13.92L14.4635 12.7067L10.2635 10.1867V5.33332Z"})})},edit:function(){const{selectedStep:e,errors:t}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep(),errors:e(C.storeName).getStepError(e(C.storeName).getSelectedStep().id)})),[]),a=(null==t?void 0:t.fields)??{},i=(null==a?void 0:a.delay)??"",o=(null==a?void 0:a.delay_type)??"",s=`delay-number-${e.id}`;return(0,D.jsxs)(Me.Z,{opened:!0,children:[(0,D.jsx)("label",{htmlFor:s,children:(0,D.jsx)(jt.L,{title:(0,x.__)("Wait for","mailpoet")})}),(0,D.jsxs)(xt.Z,{align:"top",children:[(0,D.jsx)(vt.Z,{style:{flex:"1 1 0"},className:i?"mailpoet-automation-field__error":"",children:(0,D.jsx)(y.Z,{id:s,help:i,type:"number",placeholder:(0,x.__)("Number","mailpoet"),value:e.args.delay??"",onChange:t=>{const a=0===t.length||parseInt(t,10)<1?1:parseInt(t,10);(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"delay",a)}})}),(0,D.jsx)(vt.Z,{style:{flex:"1 1 0"},className:o?"mailpoet-automation-field__error":"",children:(0,D.jsx)(bt.Z,{label:"",help:o,value:e.args.delay_type??"HOURS",options:ft,onChange:t=>(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"delay_type",t)})})]})]})}};var Nt=a(34352),kt=a.n(Nt),wt=a(73995);function St(){return(0,D.jsxs)("span",{className:"mailpoet-shortcode-selector",children:["You can use"," ",(0,D.jsx)("a",{href:"https://kb.mailpoet.com/article/215-personalize-newsletter-with-shortcodes",target:"_blank",rel:"noopener noreferrer",children:(0,x.__)("MailPoet shortcodes","mailpoet")})]})}var Zt=a(42196),Ct=a(76731),At=a(67794),Dt=a(31870);function Et(e){let{currentName:t,defaultName:a,update:i}=e;return(0,D.jsx)(k.Z,{className:"mailpoet-step-name-dropdown",contentClassName:"mailpoet-step-name-popover",position:"bottom left",popoverProps:{placement:"bottom-start"},renderToggle:e=>{let{isOpen:i,onToggle:o}=e;return(0,D.jsx)(At.L,{title:t.length>0?t:a,children:(0,D.jsx)(Dt.a,{onClick:o,"aria-expanded":i,"aria-label":(0,x.__)("Edit step name","mailpoet"),children:(0,D.jsx)(ce.Z,{icon:Ct.Z,size:16})})})},renderContent:()=>(0,D.jsx)(y.Z,{label:(0,x.__)("Step name","mailpoet"),className:"mailpoet-step-name-input",placeholder:a,value:t,onChange:i,help:(0,x.__)('Give the automation step a name that indicates its purpose. E.g "Abandoned cart recovery". This name will be displayed only to you and not to the clients.',"mailpoet")})})}function Tt(e){let{centered:t,variant:a,...i}=e;return(0,D.jsx)(l.ZP,{className:o()(["sidebar-primary"===a?"mailpoet-automation-button-sidebar-primary":"",t?"mailpoet-automation-button-centered":""]),variant:"sidebar-primary"===a?"primary":a,...i})}const Pt={};function It(){var e;const[t,a]=(0,n.useState)(!1),[i,o]=(0,n.useState)(!1),{selectedStep:s,automationId:r,automationSaved:l,errors:c}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep(),automationId:e(C.storeName).getAutomationData().id,automationSaved:e(C.storeName).getAutomationSaved(),errors:e(C.storeName).getStepError(e(C.storeName).getSelectedStep().id)})),[]),d=null==s||null===(e=s.args)||void 0===e?void 0:e.email_id,m=s.id,_=(null==c?void 0:c.fields)??{},h=(null==_?void 0:_.email_id)??"",g=(0,n.useCallback)((async()=>{a(!0);const e=await Y.x.Ajax.post({api_version:window.mailpoet_api_version,endpoint:"newsletters",action:"create",data:{type:"automation",subject:"",options:{automationId:r,automationStepId:m}}});(0,p.dispatch)(C.storeName).updateStepArgs(m,"email_id",parseInt(e.data.id,10)),(0,p.dispatch)(C.storeName).save()}),[r,m]);return(0,n.useEffect)((()=>{t&&d&&l&&(window.location.href=`admin.php?page=mailpoet-newsletters#/template/${d}`)}),[d,l,t]),!d||t?(0,D.jsxs)("div",{className:h?"mailpoet-automation-field__error":"",children:[(0,D.jsx)(Tt,{variant:"sidebar-primary",centered:!0,icon:B.Z,onClick:g,isBusy:t,disabled:t,children:(0,x.__)("Design email","mailpoet")}),h&&(0,D.jsx)("span",{className:"mailpoet-automation-field-message",children:(0,x.__)("You need to design an email before you can activate the automation","mailpoet")})]}):(0,D.jsxs)("div",{className:"mailpoet-automation-email-buttons",children:[(0,D.jsx)(Tt,{variant:"sidebar-primary",centered:!0,href:`?page=mailpoet-newsletter-editor&id=${s.args.email_id}`,children:(0,x.__)("Edit content","mailpoet")}),(0,D.jsx)(Tt,{variant:"secondary",centered:!0,isBusy:i,disabled:i,onClick:async()=>{o(!0);const e=await(async e=>{var t;if(Pt[e]&&Pt[e].length>0)return Pt[e];const a=await Y.x.Ajax.post({api_version:window.mailpoet_api_version,endpoint:"newsletters",action:"get",data:{id:e}});return Pt[e]=(null==a||null===(t=a.meta)||void 0===t?void 0:t.preview_url)??"",Pt[e]})(d);window.open(e,"_blank"),o(!1)},children:(0,x.__)("Preview","mailpoet")})]})}function Ft(e){return(0,D.jsx)(wt.Z,{...e,onChange:t=>e.onChange(t.replaceAll(/(\r?\n)+/g," ")),onKeyDown:t=>{"Enter"===t.key&&t.preventDefault(),e.onKeyDown&&e.onKeyDown(t)}})}function Rt(){const{selectedStep:e,errors:t}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep(),selectedStepType:e(C.storeName).getSelectedStepType(),errors:e(C.storeName).getStepError(e(C.storeName).getSelectedStep().id)})),[]),a=(null==t?void 0:t.fields)??{},i=(null==a?void 0:a.sender_name)??"",o=(null==a?void 0:a.sender_address)??"",s=(null==a?void 0:a.subject)??"";return(0,D.jsxs)(Me.Z,{opened:!0,children:[(0,D.jsx)(Et,{currentName:e.args.name??"",defaultName:(0,x.__)("Send email","mailpoet"),update:t=>{(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"name",t)}}),(0,D.jsx)(y.Z,{className:i?"mailpoet-automation-field__error":"",help:i,label:(0,x.__)('"From" name',"mailpoet"),placeholder:(0,x.__)("John Doe","mailpoet"),value:e.args.sender_name??"",onChange:t=>(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"sender_name",t)}),(0,D.jsx)(y.Z,{className:o?"mailpoet-automation-field__error":"",help:o,type:"email",label:(0,x.__)('"From" email address',"mailpoet"),placeholder:(0,x.__)("you@domain.com","mailpoet"),value:e.args.sender_address??"",onChange:t=>(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"sender_address",t)}),(0,D.jsx)(Ft,{className:s?"mailpoet-automation-field__error":"",label:(0,x.__)("Subject","mailpoet"),placeholder:(0,x.__)("Type in subject…","mailpoet"),value:e.args.subject??"",onChange:t=>(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"subject",t),help:(0,D.jsxs)(D.Fragment,{children:[`${s} `,(0,D.jsx)(St,{})]})}),(0,D.jsx)(Ft,{label:(0,x.__)("Preheader","mailpoet"),placeholder:(0,x.__)("Type in preheader…","mailpoet"),value:e.args.preheader??"",onChange:t=>(0,p.dispatch)(C.storeName).updateStepArgs(e.id,"preheader",t),help:(0,D.jsx)(St,{})}),(0,D.jsx)("div",{className:"mailpoet-automation-email-content-separator"}),(0,D.jsx)(Zt.PlainBodyTitle,{title:(0,x.__)("Email","mailpoet")}),(0,D.jsx)(It,{})]})}var Lt=a(41974);function Vt(e){let{hasErrors:t=!1,...a}=e;const[i,o]=(0,n.useState)(a.initialOpen);return(0,n.useEffect)((()=>{t&&o(!0)}),[t]),(0,D.jsx)(Me.Z,{opened:i,onToggle:()=>o((e=>!e)),...a})}function Ht(){var e;const{selectedStep:t,errors:a}=(0,u.Z)((e=>{var t,a;return{selectedStep:e(C.storeName).getSelectedStep(),errors:null===(t=e(C.storeName).getStepError(e(C.storeName).getSelectedStep().id))||void 0===t||null===(a=t.fields)||void 0===a?void 0:a.ga_campaign}}),[]),{updateStepArgs:i}=(0,N.Z)(C.storeName),o=void 0!==(null===(e=t.args)||void 0===e?void 0:e.ga_campaign),[s,r]=(0,n.useState)(o),l=$e.Hooks.applyFilters("mailpoet.automation.send_email.google_analytics_panel",(0,D.jsx)(lt.ZG,{onRequestClose:()=>{r(!1),i(t.id,"ga_campaign",void 0)},children:(0,x.__)("Google Analytics tracking is not available in the free version of the MailPoet plugin.","mailpoet")}));return(0,D.jsxs)(Vt,{title:(0,x.__)("Google Analytics","mailpoet"),initialOpen:!1,hasErrors:!!a,children:[(0,D.jsx)(Lt.Z,{label:(0,x.__)("Enable custom GA tracking","mailpoet"),checked:s,onChange:e=>{r(e),e||i(t.id,"ga_campaign",void 0)}}),s&&l]})}function Mt(){var e,t,a,i;const{registry:o,selectedStep:s,errors:r}=(0,u.Z)((e=>({registry:e(C.storeName).getRegistry(),selectedStep:e(C.storeName).getSelectedStep(),errors:e(C.storeName).getStepError(e(C.storeName).getSelectedStep().id)})),[]),{updateStepArgs:l}=(0,N.Z)(C.storeName),c=s.args,d=!!c.reply_to_name||!!c.reply_to_address,[m,p]=(0,n.useState)(d),_=(0,n.useRef)(),h=(null===(e=o.steps["mailpoet:send-email"])||void 0===e||null===(t=e.args_schema)||void 0===t?void 0:t.properties)??{},g=null===(a=h.reply_to_name)||void 0===a?void 0:a.default,v=null===(i=h.reply_to_address)||void 0===i?void 0:i.default,b=(null==r?void 0:r.fields)??{},j=(null==b?void 0:b.reply_to_name)??"",f=(null==b?void 0:b.reply_to_address)??"";return(0,D.jsxs)(Vt,{title:(0,x.__)("Reply to","mailpoet"),initialOpen:!1,hasErrors:!!j||!!f,children:[(0,D.jsx)(Lt.Z,{label:(0,x.__)("Use different email address for getting replies to the email","mailpoet"),checked:m,onChange:e=>{p(e);const t=s.id;if(e){var a,i;const e=(null===(a=_.current)||void 0===a?void 0:a.name)??g,o=(null===(i=_.current)||void 0===i?void 0:i.address)??v;l(t,"reply_to_name",e),l(t,"reply_to_address",o)}else _.current={name:c.reply_to_name,address:c.reply_to_address},l(t,"reply_to_name",void 0),l(t,"reply_to_address",void 0)}}),m&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(y.Z,{className:j?"mailpoet-automation-field__error":"",help:j,label:(0,x.__)('"Reply to" name',"mailpoet"),placeholder:(0,x.__)("John Doe","mailpoet"),value:c.reply_to_name??"",onChange:e=>l(s.id,"reply_to_name",e||void 0)}),(0,D.jsx)(y.Z,{className:f?"mailpoet-automation-field__error":"",help:f,type:"email",label:(0,x.__)('"Reply to" email address',"mailpoet"),placeholder:(0,x.__)("you@domain.com","mailpoet"),value:c.reply_to_address??"",onChange:e=>l(s.id,"reply_to_address",e||void 0)})]})]})}const Ot=["woocommerce:order-status-changed"];function Bt(e){const t=(0,p.select)(C.storeName).getAutomationData(),a=Object.values(t.steps).filter((e=>"trigger"===e.type));let i=null;if(a.forEach((e=>{!0!==i||Ot.includes(e.key)||(i=!1),null===i&&Ot.includes(e.key)&&(i=!0)})),!i)return!1;let o=!1;return a.forEach((t=>{t.next_steps.map((e=>e.id)).includes(e.id)&&(o=!0)})),o}function Kt(){return(0,D.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,D.jsx)("rect",{width:"12",height:"12",rx:"6",fill:"#787C82"}),(0,D.jsx)("path",{d:"M2.80002 8.8V8.2H3.64002V5.14C3.64002 4.58 3.80502 4.08167 4.13502 3.645C4.46502 3.20833 4.90002 2.93333 5.44002 2.82V2.53C5.44002 2.37667 5.49502 2.25 5.60502 2.15C5.71502 2.05 5.84668 2 6.00002 2C6.15335 2 6.28502 2.05 6.39502 2.15C6.50502 2.25 6.56002 2.37667 6.56002 2.53V2.82C7.10002 2.93333 7.53668 3.20833 7.87002 3.645C8.20335 4.08167 8.37002 4.58 8.37002 5.14V8.2H9.20002V8.8H2.80002ZM6.00002 10C5.78668 10 5.60002 9.92167 5.44002 9.765C5.28002 9.60833 5.20002 9.42 5.20002 9.2H6.80002C6.80002 9.42 6.72168 9.60833 6.56502 9.765C6.40835 9.92167 6.22002 10 6.00002 10Z",fill:"white"})]})}function Ut(){return(0,D.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,D.jsx)("rect",{width:"12",height:"12",rx:"6",fill:"#787C82"}),(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.23143 6.81203L2.29999 6.61499H2.04999C1.91192 6.61499 1.79999 6.50306 1.79999 6.36499V4.86499C1.79999 4.72692 1.91192 4.61499 2.04999 4.61499H2.29999L8.79999 3.23999H9.79999V7.98999H8.79999L6.87343 7.58245L6.88617 7.58634C6.58341 8.57663 5.53519 9.13398 4.5449 8.83122L4.76418 8.11399C5.33738 8.28923 5.94293 7.9842 6.14805 7.429L3.96998 6.96826C3.93792 7.4763 4.25606 7.95869 4.76414 8.11403L4.54486 8.83126C3.66158 8.56121 3.12273 7.69811 3.23143 6.81203Z",fill:"white"})]})}const Wt={key:"mailpoet:send-email",group:"actions",title:(e,t)=>{if("automation"!==t)return(0,x.__)("Send email","mailpoet");const a=e&&Bt(e)?Kt:Ut;return(0,D.jsxs)(D.Fragment,{children:[(0,x.__)("Send email","mailpoet")," ",(0,D.jsx)(a,{})]})},description:e=>{const t="63cfbc82f544d52e61429a02",a=(0,D.jsx)("span",{className:"mailpoet-sendemail-description-main",children:(0,x.__)("An email will be sent to subscriber.","mailpoet")});if(Bt(e)){const e=kt()((0,x.__)("This is a transactional email. This type of email doesn't require marketing consent. Read more about [link]transactional emails[/link].","mailpoet"),/\[link\](.*?)\[\/link\]/g,(e=>(0,D.jsx)("a",{rel:"noreferrer",href:"https://kb.mailpoet.com/article/397-how-to-set-up-an-automation",target:"_blank","data-beacon-article":t,children:e})));return(0,D.jsxs)("span",{className:"mailpoet-sendmail-description",children:[a,(0,D.jsx)(Kt,{}),(0,D.jsx)("span",{className:"mailpoet-sendmail-description-type",children:e})]})}const i=kt()((0,x.__)("This is a marketing email. This type of email does require marketing consent. Read more about [link]marketing emails[/link].","mailpoet"),/\[link\](.*?)\[\/link\]/g,(e=>(0,D.jsx)("a",{rel:"noreferrer",href:"https://kb.mailpoet.com/article/397-how-to-set-up-an-automation",target:"_blank","data-beacon-article":t,children:e})));return(0,D.jsxs)("span",{className:"mailpoet-sendmail-description",children:[a,(0,D.jsx)(Ut,{}),(0,D.jsx)("span",{className:"mailpoet-sendmail-description-type",children:i})]})},keywords:[(0,x.__)("email","mailpoet"),(0,x.__)("send email","mailpoet"),(0,x.__)("send","mailpoet")],subtitle:e=>e.args.name??(0,x.__)("Send email","mailpoet"),foreground:"#996800",background:"#FCF9E8",icon:function(){return(0,D.jsx)("svg",{viewBox:"0 0 16 12",xmlns:"http://www.w3.org/2000/svg",children:(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.73578 1.5L8 6.01219L13.2642 1.5H2.73578ZM14.5 2.41638L8.48809 7.56944L8 7.98781L7.51191 7.56944L1.5 2.41638V10C1.5 10.2761 1.72386 10.5 2 10.5H14C14.2761 10.5 14.5 10.2761 14.5 10V2.41638ZM0 2C0 0.89543 0.89543 0 2 0H14C15.1046 0 16 0.895431 16 2V10C16 11.1046 15.1046 12 14 12H2C0.895431 12 0 11.1046 0 10V2Z"})})},edit:function(){return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Rt,{}),(0,D.jsx)(Mt,{}),(0,D.jsx)(Ht,{})]})},createStep:(e,t)=>$e.Hooks.applyFilters("mailpoet.automation.send_email.create_step",e,t.automationData.id)};var zt=a(16735);function Gt(){var e;const{selectedStep:t}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep()})),[]),a=null!==(e=t.args)&&void 0!==e&&e.segment_ids?t.args.segment_ids:[],i=(0,p.select)(C.storeName).getContext("mailpoet").segments.filter((e=>"default"===e.type)),o=i.filter((e=>a.includes(e.id)));return(0,D.jsxs)(Me.Z,{opened:!0,children:[(0,D.jsx)(Zt.PlainBodyTitle,{title:(0,x.__)("Trigger settings","mailpoet")}),(0,D.jsx)(Zt.FormTokenField,{label:(0,x.__)("When someone subscribes to the following lists:","mailpoet"),placeholder:(0,x.__)("Any list","mailpoet"),value:o,suggestions:i,onChange:e=>{(0,p.dispatch)(C.storeName).updateStepArgs(t.id,"segment_ids",e.map((e=>e.id)))}})]})}function $t(){return(0,D.jsx)(Gt,{})}const qt={key:"mailpoet:someone-subscribes",group:"triggers",title:()=>(0,x.__)("Someone subscribes","mailpoet"),description:()=>(0,x.__)("Starts the automation when a new subscriber is added to MailPoet.","mailpoet"),subtitle:()=>(0,x._x)("Trigger","noun","mailpoet"),keywords:[(0,x.__)("subscribe","mailpoet"),(0,x.__)("new subscriber","mailpoet"),(0,x.__)("subscription","mailpoet")],foreground:"#2271b1",background:"#f0f6fc",icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.4"},children:zt.Z}),edit:()=>(0,D.jsx)($t,{})},Jt=Object.keys(window.mailpoet_user_roles).map((e=>({id:e,name:window.mailpoet_user_roles[e]})));function Yt(){return(0,D.jsx)("p",{children:kt()((0,x.__)("[link]Subscribe in registration form[/link] setting must be enabled.","mailpoet"),/\[link\](.*?)\[\/link\]/g,(e=>(0,D.jsx)("a",{href:"admin.php?page=mailpoet-settings#/basics",target:"_blank",children:e})))})}function Qt(){var e;const{selectedStep:t}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep()})),[]),a=null!==(e=t.args)&&void 0!==e&&e.roles?t.args.roles:[],i=Jt.filter((e=>a.includes(e.id)));return(0,D.jsxs)(Me.Z,{opened:!0,children:[(0,D.jsx)(Zt.PlainBodyTitle,{title:(0,x.__)("Trigger settings","mailpoet")}),(0,D.jsx)(Yt,{}),(0,D.jsx)(Zt.FormTokenField,{label:(0,x.__)("When WordPress user role is:","mailpoet"),value:i,suggestions:Jt,placeholder:(0,x.__)("Any user role","mailpoet"),onChange:e=>{(0,p.dispatch)(C.storeName).updateStepArgs(t.id,"roles",e.map((e=>e.id)))}})]})}function Xt(){return(0,D.jsx)(Qt,{})}const ea={key:"mailpoet:wp-user-registered",group:"triggers",title:()=>(0,x.__)("WordPress user registers","mailpoet"),foreground:"#2271b1",background:"#f0f6fc",description:()=>(0,x.__)("Starts the automation when a new user registered in WordPress.","mailpoet"),subtitle:()=>(0,x._x)("Trigger","noun","mailpoet"),keywords:[(0,x.__)("wordpress","mailpoet"),(0,x.__)("user","mailpoet"),(0,x.__)("register","mailpoet")],icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.12"},children:_.Z}),edit:()=>(0,D.jsx)(Xt,{})};var ta=a(46945);const aa=(0,D.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,D.jsx)("g",{clipPath:"url(#clip0_1896_34966)",children:(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 1.625C4.96447 1.625 4.125 2.46447 4.125 3.5V5H3.5C3.22386 5 3 5.22386 3 5.5V9.5C3 9.77614 3.22386 10 3.5 10H8.5C8.77614 10 9 9.77614 9 9.5V5.5C9 5.22386 8.77614 5 8.5 5H7.875V3.5C7.875 2.46447 7.03553 1.625 6 1.625ZM7.125 5V3.5C7.125 2.87868 6.62132 2.375 6 2.375C5.37868 2.375 4.875 2.87868 4.875 3.5V5H7.125Z",fill:"#BD8600"})}),(0,D.jsx)("defs",{children:(0,D.jsx)("clipPath",{id:"clip0_1896_34966",children:(0,D.jsx)("rect",{width:"12",height:"12",fill:"white"})})})]});function ia(e){let{text:t}=e;return(0,D.jsxs)("span",{className:"mailpoet-locked-badge",children:[aa," ",t]})}const oa={key:"mailpoet:add-tag",group:"actions",title:()=>(0,x.__)("Add tag","mailpoet"),description:()=>(0,x.__)("Add a tag or multiple tags to a subscriber.","mailpoet"),subtitle:()=>(0,D.jsx)(ia,{text:(0,x.__)("Premium","mailpoet")}),keywords:[(0,x.__)("tag","mailpoet"),(0,x.__)("tags","mailpoet"),(0,x.__)("label","mailpoet"),(0,x.__)("labels","mailpoet"),(0,x.__)("add tag","mailpoet"),(0,x.__)("add tags","mailpoet")],foreground:"#00A32A",background:"#EDFAEF",icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.4"},children:ta.Z}),edit:()=>(0,D.jsx)(lt.J9,{tracking:{utm_medium:"upsell_modal",utm_campaign:"create_automation_editor_add_tag"},children:(0,x.__)("Adding tags is a premium feature.","mailpoet")})},sa={key:"mailpoet:remove-tag",group:"actions",title:()=>(0,x.__)("Remove tag","mailpoet"),description:()=>(0,x.__)("Remove a tag or multiple tags from a subscriber.","mailpoet"),subtitle:()=>(0,D.jsx)(ia,{text:(0,x.__)("Premium","mailpoet")}),keywords:[(0,x.__)("tag","mailpoet"),(0,x.__)("remove tag","mailpoet"),(0,x.__)("remove tags","mailpoet")],foreground:"#00A32A",background:"#EDFAEF",icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.4"},children:ta.Z}),edit:()=>(0,D.jsx)(lt.J9,{tracking:{utm_medium:"upsell_modal",utm_campaign:"create_automation_editor_remove_tag"},children:(0,x.__)("Removing tags is a premium feature.","mailpoet")})};var na=a(27414);const ra={key:"mailpoet:add-to-list",group:"actions",title:()=>(0,x.__)("Add to list","mailpoet"),description:()=>(0,x.__)("Add a subscriber to a list.","mailpoet"),subtitle:()=>(0,D.jsx)(ia,{text:(0,x.__)("Premium","mailpoet")}),keywords:[(0,x.__)("list","mailpoet"),(0,x.__)("add list","mailpoet"),(0,x.__)("add to list","mailpoet")],foreground:"#00A32A",background:"#EDFAEF",icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.12"},children:na.Z}),edit:()=>(0,D.jsx)(lt.J9,{tracking:{utm_medium:"upsell_modal",utm_campaign:"create_automation_editor_add_to_list"},children:(0,x.__)("Adding subscribers to lists is a premium feature.","mailpoet")})},la={key:"mailpoet:remove-from-list",group:"actions",title:()=>(0,x.__)("Remove from list","mailpoet"),description:()=>(0,x.__)("Remove a subscriber from a list.","mailpoet"),subtitle:()=>(0,D.jsx)(ia,{text:(0,x.__)("Premium","mailpoet")}),keywords:[(0,x.__)("list","mailpoet"),(0,x.__)("remove list","mailpoet"),(0,x.__)("remove from list","mailpoet")],foreground:"#00A32A",background:"#EDFAEF",icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.12"},children:na.Z}),edit:()=>(0,D.jsx)(lt.J9,{tracking:{utm_medium:"upsell_modal",utm_campaign:"create_automation_editor_remove_from_list"},children:(0,x.__)("Removing subscribers from lists is a premium feature.","mailpoet")})};var ca=a(11711);const da={key:"mailpoet:update-subscriber",group:"actions",title:()=>(0,x.__)("Update subscriber","mailpoet"),description:()=>(0,x.__)("Update the subscriber’s custom field to a specific value.","mailpoet"),subtitle:()=>(0,D.jsx)(ia,{text:(0,x.__)("Premium","mailpoet")}),keywords:[(0,x.__)("update","mailpoet"),(0,x.__)("update subscriber","mailpoet"),(0,x.__)("update custom field","mailpoet")],foreground:"#00A32A",background:"#EDFAEF",icon:()=>(0,D.jsx)("div",{style:{width:"100%",height:"100%",scale:"1.3"},children:ca.Z}),edit:()=>(0,D.jsx)(lt.J9,{tracking:{utm_medium:"upsell_modal",utm_campaign:"create_automation_editor_update_subscriber"},children:(0,x.__)("Updating subscribers is a premium feature.","mailpoet")})};function ma(){return(0,D.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 21 16",xmlns:"http://www.w3.org/2000/svg",children:[(0,D.jsx)("path",{d:"M 12,3.99997 C 12,1.78997 10.21,-3.05e-5 8,-3.05e-5 5.79,-3.05e-5 4,1.78997 4,3.99997 4,6.21 5.79,8 8,8 10.21,8 12,6.21 12,3.99997 Z m -2.0000002,0 C 9.9999998,5.09997 9.1,6 8,6 6.9,6 6,5.09997 6,3.99997 c 0,-1.1 0.9,-2 2,-2 1.1,0 1.9999998,0.9 1.9999998,2 z"}),(0,D.jsx)("path",{d:"m 0,14 v 2 h 16 v -2 c 0,-2.66 -5.33,-4 -8,-4 -2.67,0 -8,1.34 -8,4 z m 2,0 c 0.2,-0.71 3.3,-2 6,-2 2.69,0 5.77,1.28 6,2 z"}),(0,D.jsx)("path",{d:"m 21,6 h -6 v 2 h 6 z"})]})}const pa={key:"mailpoet:unsubscribe",group:"actions",title:()=>(0,x.__)("Unsubscribe","mailpoet"),description:()=>(0,x.__)("Unsubscribe the subscriber from all marketing emails.","mailpoet"),subtitle:()=>(0,D.jsx)(ia,{text:(0,x.__)("Premium","mailpoet")}),keywords:[(0,x.__)("unsubscribe","mailpoet")],foreground:"#00A32A",background:"#EDFAEF",icon:()=>(0,D.jsx)(ma,{}),edit:()=>(0,D.jsx)(lt.J9,{tracking:{utm_medium:"upsell_modal",utm_campaign:"create_automation_editor_unsubscribe"},children:(0,x.__)("Unsubscribing is a premium feature.","mailpoet")})};var ua=a(99173);const _a=e=>{var t;const a=Number.isInteger(null===(t=e.args)||void 0===t?void 0:t.email_id);return{key:"statistics",control:{icon:ua.Z,title:(0,x.__)("Email statistics","mailpoet"),isDisabled:!a,onClick:()=>{window.open(`admin.php?page=mailpoet-newsletters#/stats/${e.args.email_id}`,"_blank")}},slot:()=>null}};function ha(){var e;const{automationData:t}=(0,u.Z)((e=>({automationData:e(C.storeName).getAutomationData()})),[]),a=(null===(e=t.meta)||void 0===e?void 0:e["mailpoet:run-once-per-subscriber"])||!1;return(0,D.jsx)(Lt.Z,{className:"mailpoet-automation-run-only-once",label:(0,x.__)("Run this automation only once per subscriber.","mailpoet"),checked:a,onChange:e=>{(0,p.dispatch)(C.storeName).updateAutomationMeta("mailpoet:run-once-per-subscriber",e)}})}const ga=()=>{(0,C.registerStepType)(Wt),(0,C.registerStepType)(ea),(0,C.registerStepType)(qt),(0,C.registerStepType)(oa),(0,C.registerStepType)(sa),(0,C.registerStepType)(ra),(0,C.registerStepType)(la),(0,C.registerStepType)(da),(0,C.registerStepType)(pa),$e.Hooks.addFilter("mailpoet.automation.step.more-controls","mailpoet",((e,t)=>"mailpoet:send-email"===t.key?{statistics:_a(t),...e}:e)),$e.Hooks.addFilter("mailpoet.automation.settings.render","mailpoet",(e=>function(){const e=(0,p.select)(C.storeName).getAutomationData(),t=Object.values(e.steps).filter((e=>"trigger"===e.type));return 0===t.length||t.filter((e=>(0,p.select)(C.storeName).getStepSubjectKeys(e.key).includes("mailpoet:subscriber"))).length>0}()?{...e,run_automation_once:(0,D.jsx)(ha,{})}:e))},xa="wc-completed";function va(){var e,t;const[a,i]=(0,n.useState)(!1),{selectedStep:o}=(0,u.Z)((e=>({selectedStep:e(C.storeName).getSelectedStep()})),[]),s=new Map;s.set("any",{value:"any",label:(0,x.__)("Any","mailpoet"),isDisabled:!1}),function(){const e=new Map,t=(0,p.select)(C.storeName).getContext("woocommerce");return Object.keys((null==t?void 0:t.order_statuses)||{}).forEach((a=>{e.set(a,{value:a,label:t.order_statuses[a],isDisabled:a!==xa})})),$e.Hooks.applyFilters("mailpoet.automation.trigger.order_status_changed.order_status_options",e)}().forEach((e=>s.set(e.value,e)));const r=(null===(e=o.args)||void 0===e?void 0:e.from)??"any",l=(null===(t=o.args)||void 0===t?void 0:t.to)??xa,c=(e,t)=>{const a=s.get(e).isDisabled?xa:e;(0,p.dispatch)(C.storeName).updateStepArgs(o.id,t,a),i(s.get(e).isDisabled)};return(0,D.jsxs)(Vt,{opened:!0,children:[(0,D.jsx)(Zt.PlainBodyTitle,{title:(0,x.__)("Trigger settings","mailpoet")}),(0,D.jsx)(bt.Z,{value:r,label:(0,x.__)("Status changes from:","mailpoet"),options:[...s.values()],onChange:e=>c(e,"from")}),(0,D.jsx)(bt.Z,{value:l,label:(0,x.__)("Status changes to:","mailpoet"),options:[...s.values()],onChange:e=>c(e,"to")}),a&&(0,D.jsx)(lt.ZG,{onRequestClose:()=>i(!1),tracking:{utm_medium:"upsell_modal",utm_campaign:"trigger_order_status_changed"},children:(0,x.__)("Changing the status is a premium feature.","mailpoet")})]})}function ba(){return(0,D.jsx)(va,{})}function ja(){return(0,D.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 14 16",xmlns:"http://www.w3.org/2000/svg",children:[(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M 8.2740001,1.4545501 C 7.98,0.6109101 7.2100001,1e-7 6.3000001,1e-7 5.39,1e-7 4.6200001,0.6109101 4.326,1.4545501 H 1.4 C 0.63,1.4545501 0,2.10909 0,2.90909 V 13.0909 c 0,0.8 0.63,1.4546 1.4,1.4546 H 4.9 V 13.0909 H 1.4 V 2.90909 h 9.8 V 6.5455 h 1.4 V 2.90909 c 0,-0.8 -0.63,-1.4545399 -1.4,-1.4545399 z m -1.449,0.36363 c 0,-0.29818 -0.238,-0.54545 -0.525,-0.54545 -0.287,0 -0.5250001,0.24727 -0.5250001,0.54545 0,0.2981799 0.238,0.5454599 0.5250001,0.5454599 0.287,0 0.525,-0.24728 0.525,-0.5454599 z"}),(0,D.jsx)("path",{d:"m 2.8000001,4.36364 v 1.45454 h 7 V 4.36364 Z"}),(0,D.jsx)("path",{d:"m 4.9000001,7.2727 h -2.1 v 1.4546 h 2.1 z"}),(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M 12.11,13.0182 C 12.39,12.5091 12.6,11.9273 12.6,11.2727 12.6,9.4545 11.2,8 9.4500001,8 7.7,8 6.3,9.4545 6.3,11.2727 c 0,1.8182 1.4,3.2728 3.1500001,3.2728 C 10.08,14.5455 10.64,14.3273 11.13,14.0364 L 13.02,16 14,14.9818 Z M 9.4500001,13.0909 C 8.4700001,13.0909 7.7,12.2909 7.7,11.2727 7.7,10.2545 8.4700001,9.4545 9.4500001,9.4545 10.43,9.4545 11.2,10.2545 11.2,11.2727 c 0,1.0182 -0.77,1.8182 -1.7499999,1.8182 z"})]})}const fa={key:"woocommerce:order-status-changed",group:"triggers",title:()=>(0,x.__)("Order status changed","mailpoet"),description:()=>(0,x.__)("Start the automation when an order is created or changed to a specific status.","mailpoet"),subtitle:()=>(0,x._x)("Trigger","noun","mailpoet"),keywords:[(0,x.__)("woocommerce","mailpoet"),(0,x.__)("order","mailpoet"),(0,x.__)("status","mailpoet"),(0,x.__)("change","mailpoet")],foreground:"#2271b1",background:"#f0f6fc",icon:()=>(0,D.jsx)(ja,{}),edit:()=>(0,D.jsx)(ba,{})};var ya=a(40158),Na=a(77159),ka=a(73985),wa=a(15128);function Sa(e){let{onClose:t}=e;const[a,i]=(0,n.useState)(!1),{activate:o}=(0,N.Z)(C.storeName);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:"mailpoet-automation-activate-panel__header",children:[(0,D.jsx)("div",{className:"mailpoet-automation-activate-panel__header-activate-button",children:(0,D.jsxs)(l.ZP,{variant:"primary",disabled:a,isBusy:a,autoFocus:!a,onClick:()=>{i(!0),o()},children:[a&&(0,x.__)("Activating…","mailpoet"),!a&&(0,x.__)("Activate","mailpoet")]})}),(0,D.jsx)("div",{className:"mailpoet-automation-activate-panel__header-cancel-button",children:(0,D.jsx)(l.ZP,{variant:"secondary",onClick:t,disabled:a,children:(0,x.__)("Cancel","mailpoet")})})]}),a&&(0,D.jsx)("div",{className:"mailpoet-automation-activate-panel__body",children:(0,D.jsx)(ka.ZP,{})}),!a&&(0,D.jsxs)("div",{className:"mailpoet-automation-activate-panel__body",children:[(0,D.jsx)("p",{children:(0,D.jsx)("strong",{children:(0,x.__)("Are you ready to activate?","mailpoet")})}),(0,D.jsx)("p",{children:(0,x.__)("Double-check your settings before activating.","mailpoet")})]})]})}function Za(e){let{onClose:t}=e;const{automation:a}=(0,u.Z)((e=>({automation:e(C.storeName).getAutomationData()})),[]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{className:"mailpoet-automation-activate-panel__header",children:(0,D.jsx)(l.ZP,{icon:wa.Z,onClick:t,label:(0,x.__)("Close","mailpoet")})}),(0,D.jsxs)("div",{className:"mailpoet-automation-activate-panel__body",children:[(0,D.jsx)("div",{className:"mailpoet-automation-activate-panel__section",children:(0,x.sprintf)((0,x.__)('"%s" is now live.',"mailpoet"),a.name)}),(0,D.jsx)("p",{children:(0,D.jsx)("strong",{children:(0,x.__)("What’s next?","mailpoet")})}),(0,D.jsx)("p",{children:(0,x.__)("View all your automations to track statistics and create new ones.","mailpoet")}),(0,D.jsx)(l.ZP,{variant:"secondary",onClick:()=>{window.location.href=Y.x.urls.automationListing},children:(0,x.__)("View all automations","mailpoet")})]})]})}function Ca(){const{automation:e,errors:t}=(0,u.Z)((e=>({errors:e(C.storeName).getErrors(),automation:e(C.storeName).getAutomationData()})),[]),{closeActivationPanel:a}=(0,N.Z)(C.storeName);if((0,n.useEffect)((()=>{t&&a()}),[t,a]),t)return null;const i=e.status===A.b.ACTIVE;return(0,D.jsxs)("div",{className:"mailpoet-automation-activate-panel",children:[i&&(0,D.jsx)(Za,{onClose:a}),!i&&(0,D.jsx)(Sa,{onClose:a})]})}function Aa(e){return(0,p.select)(C.storeName).getAutomationSaved()?"":(e.returnValue=(0,x.__)("There are unsaved changes that will be lost. Do you want to continue?","mailpoet"),e.returnValue)}function Da(){const{isFullscreenActive:e,isInserterOpened:t,isActivationPanelOpened:a,isSidebarOpened:i,showIconLabels:s,automation:b}=(0,u.Z)((e=>({isFullscreenActive:e(C.storeName).isFeatureActive("fullscreenMode"),isInserterOpened:e(C.storeName).isInserterSidebarOpened(),isSidebarOpened:e(C.storeName).isSidebarOpened(),isActivationPanelOpened:e(C.storeName).isActivationPanelOpened(),showIconLabels:e(C.storeName).isFeatureActive("showIconLabels"),automation:e(C.storeName).getAutomationData()})),[]),[j,f]=(0,n.useState)(!0);(0,n.useEffect)((()=>(window.addEventListener("beforeunload",Aa),()=>window.removeEventListener("beforeunload",Aa))),[]),(0,n.useEffect)((()=>{j&&(function(){const e=(0,p.select)(C.storeName).getAutomationData();if(![A.b.ACTIVE,A.b.DEACTIVATING].includes(e.status))return;if(0===e.stats.totals.in_progress)return;const{createNotice:t}=(0,p.dispatch)(m.h);t("success",(0,x.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),{type:"snackbar"})}(),f(!1))}),[j]);const y=o()("interface-interface-skeleton",{"is-sidebar-opened":i,"show-icon-labels":s});return"trash"===b.status?(window.location.href=(0,v.f)(Y.x.urls.automationListing,{[ya.E.automationHadBeenDeleted]:b.id}),null):(0,D.jsx)(g.vn,{children:(0,D.jsxs)(r.zt,{children:[(0,D.jsx)(h.x4,{isActive:e}),(0,D.jsx)(ke,{}),(0,D.jsx)(Qe,{}),(0,D.jsx)(h.v4,{className:y,drawer:e&&(0,D.jsx)("div",{className:"edit-site-navigation-toggle",children:(0,D.jsx)(l.ZP,{className:"edit-site-navigation-toggle__button has-icon",href:"admin.php?page=mailpoet-automation",children:(0,D.jsx)(c.Z,{size:36,icon:_.Z})})}),header:(0,D.jsx)(re,{showInserterToggle:!1}),content:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Fe,{}),(0,D.jsx)(ht,{})]}),sidebar:(0,D.jsx)(h.Vi.Slot,{scope:C.storeName}),secondarySidebar:null}),a&&(0,D.jsx)(Ca,{}),(0,D.jsx)(d.Z.Slot,{})]})})}window.addEventListener("DOMContentLoaded",(()=>{(0,C.createStore)();const e=document.getElementById("mailpoet_automation_editor");e&&((0,b.registerTranslations)(),Na.default.use((async(e,t)=>{try{return await t(e)}catch(e){var a;const t=e,i=null===(a=t.data)||void 0===a?void 0:a.status;if("mailpoet_automation_not_valid"===t.code)return void(0,p.dispatch)(C.storeName).setErrors({steps:t.data.errors});if(i&&i>=400&&i<500){const e=t.message;return(0,p.dispatch)(m.h).createErrorNotice(e??(0,x.__)("An unknown error occurred.","mailpoet"),{explicitDismiss:!0}),void(0,p.dispatch)(C.storeName).setErrors({steps:[]})}throw(0,p.dispatch)(m.h).createErrorNotice((0,x.__)("An unknown error occurred.","mailpoet"),{explicitDismiss:!0}),e}})),(0,gt.q)(),(0,C.registerStepType)(yt),ga(),Y.x.isWoocommerceActive&&(0,C.registerStepType)(fa),s.render((0,D.jsx)(Da,{}),e))}))},65311:function(e){e.exports=jQuery}},function(e){e.O(0,[351],(function(){return 17426,e(e.s=17426)})),e.O()}]);